!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).swetrix={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},e.apply(this,arguments)};function n(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))}function o(t,e){var n,o,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}"function"==typeof SuppressedError&&SuppressedError;var r=function(t){var e=location.search.match(t);return e&&e[2]||void 0},i=/[?&](ref|source|utm_source)=([^?&]+)/,a=/[?&](utm_campaign)=([^?&]+)/,s=/[?&](utm_medium)=([^?&]+)/,c=/[?&](utm_term)=([^?&]+)/,u=/[?&](utm_content)=([^?&]+)/,l=function(){return void 0!==navigator.languages?navigator.languages[0]:navigator.language},h=function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(t){return}},p=function(){return document.referrer||void 0},d=function(){return r(i)},f=function(){return r(s)},v=function(){return r(a)},g=function(){return r(c)},m=function(){return r(u)},b=function(t){var e=location.pathname||"";t.hash&&(e+=(n=location.hash.indexOf("?"))>-1?location.hash.substring(0,n):location.hash);if(t.search){var n=location.hash.indexOf("?");e+=location.search||(n>-1?location.hash.substring(n):"")}return e},w={stop:function(){}},y=function(){function t(t,e){this.projectID=t,this.options=e,this.pageData=null,this.pageViewsOptions=null,this.errorsOptions=null,this.perfStatsCollected=!1,this.activePage=null,this.errorListenerExists=!1,this.trackPathChange=this.trackPathChange.bind(this),this.heartbeat=this.heartbeat.bind(this),this.captureError=this.captureError.bind(this)}return t.prototype.captureError=function(t){var e,n,o,r;"number"==typeof(null===(e=this.errorsOptions)||void 0===e?void 0:e.sampleRate)&&this.errorsOptions.sampleRate>Math.random()||this.submitError({filename:t.filename,lineno:t.lineno,colno:t.colno,name:(null===(n=t.error)||void 0===n?void 0:n.name)||"Error",message:(null===(o=t.error)||void 0===o?void 0:o.message)||t.message,stackTrace:null===(r=t.error)||void 0===r?void 0:r.stack},!0)},t.prototype.trackErrors=function(t){var e=this;return this.errorListenerExists||!this.canTrack()?w:(this.errorsOptions=t,window.addEventListener("error",this.captureError),this.errorListenerExists=!0,{stop:function(){window.removeEventListener("error",e.captureError)}})},t.prototype.submitError=function(t,n){var o,r,i,a={pid:this.projectID},s=e({pg:this.activePage||b({hash:null===(o=this.pageViewsOptions)||void 0===o?void 0:o.hash,search:null===(r=this.pageViewsOptions)||void 0===r?void 0:r.search}),lc:l(),tz:h()},t);if(n&&(null===(i=this.errorsOptions)||void 0===i?void 0:i.callback)){var c=this.errorsOptions.callback(s);if(!1===c)return;c&&"object"==typeof c&&Object.assign(s,c)}Object.assign(s,a),this.sendRequest("error",s)},t.prototype.track=function(t){return n(this,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return this.canTrack()?(n=e(e({},t),{pid:this.projectID,pg:this.activePage,lc:l(),tz:h(),ref:p(),so:d(),me:f(),ca:v(),te:g(),co:m()}),[4,this.sendRequest("custom",n)]):[2];case 1:return o.sent(),[2]}}))}))},t.prototype.trackPageViews=function(t){if(!this.canTrack())return w;if(this.pageData)return this.pageData.actions;var e;this.pageViewsOptions=t,(null==t?void 0:t.unique)||(e=setInterval(this.trackPathChange,2e3)),setTimeout(this.heartbeat,3e3);var n=setInterval(this.heartbeat,28e3),o=b({hash:null==t?void 0:t.hash,search:null==t?void 0:t.search});return this.pageData={path:o,actions:{stop:function(){clearInterval(e),clearInterval(n)}}},this.trackPage(o,null==t?void 0:t.unique),this.pageData.actions},t.prototype.getPerformanceStats=function(){var t;if(!this.canTrack()||this.perfStatsCollected||!(null===(t=window.performance)||void 0===t?void 0:t.getEntriesByType))return{};var e=window.performance.getEntriesByType("navigation")[0];return e?(this.perfStatsCollected=!0,{dns:e.domainLookupEnd-e.domainLookupStart,tls:e.secureConnectionStart?e.requestStart-e.secureConnectionStart:0,conn:e.secureConnectionStart?e.secureConnectionStart-e.connectStart:e.connectEnd-e.connectStart,response:e.responseEnd-e.responseStart,render:e.domComplete-e.domContentLoadedEventEnd,dom_load:e.domContentLoadedEventEnd-e.responseEnd,page_load:e.loadEventStart,ttfb:e.responseStart-e.requestStart}):{}},t.prototype.heartbeat=function(){var t;if((null===(t=this.pageViewsOptions)||void 0===t?void 0:t.heartbeatOnBackground)||"hidden"!==document.visibilityState){var e={pid:this.projectID};this.sendRequest("hb",e)}},t.prototype.trackPathChange=function(){var t,e;if(this.pageData){var n=b({hash:null===(t=this.pageViewsOptions)||void 0===t?void 0:t.hash,search:null===(e=this.pageViewsOptions)||void 0===e?void 0:e.search});this.pageData.path!==n&&this.trackPage(n,!1)}},t.prototype.trackPage=function(t,e){if(void 0===e&&(e=!1),this.pageData){this.pageData.path=t;var n=this.getPerformanceStats();this.activePage=t,this.submitPageView({pg:t},e,n,!0)}},t.prototype.submitPageView=function(t,n,o,r){var i,a={pid:this.projectID,perf:o,unique:n},s=e({lc:l(),tz:h(),ref:p(),so:d(),me:f(),ca:v(),te:g(),co:m()},t);if(r&&(null===(i=this.pageViewsOptions)||void 0===i?void 0:i.callback)){var c=this.pageViewsOptions.callback(s);if(!1===c)return;c&&"object"==typeof c&&Object.assign(s,c)}Object.assign(s,a),this.sendRequest("",s)},t.prototype.canTrack=function(){var t,e,n,o;return!((null===(t=this.options)||void 0===t?void 0:t.disabled)||"undefined"==typeof window||(null===(e=this.options)||void 0===e?void 0:e.respectDNT)&&"1"===(null===(n=window.navigator)||void 0===n?void 0:n.doNotTrack)||!(null===(o=this.options)||void 0===o?void 0:o.devMode)&&("localhost"===(null===location||void 0===location?void 0:location.hostname)||"127.0.0.1"===(null===location||void 0===location?void 0:location.hostname)||""===(null===location||void 0===location?void 0:location.hostname))||(null===navigator||void 0===navigator?void 0:navigator.webdriver))},t.prototype.sendRequest=function(t,e){return n(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return n=(null===(r=this.options)||void 0===r?void 0:r.apiURL)||"https://api.swetrix.com/log",[4,fetch("".concat(n,"/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})];case 1:return o.sent(),[2]}}))}))},t}();t.LIB_INSTANCE=null,t.init=function(e,n){return t.LIB_INSTANCE||(t.LIB_INSTANCE=new y(e,n)),t.LIB_INSTANCE},t.pageview=function(e){t.LIB_INSTANCE&&t.LIB_INSTANCE.submitPageView(e.payload,Boolean(e.unique),{})},t.track=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return t.LIB_INSTANCE?[4,t.LIB_INSTANCE.track(e)]:[2];case 1:return n.sent(),[2]}}))}))},t.trackError=function(e){t.LIB_INSTANCE&&t.LIB_INSTANCE.submitError(e,!1)},t.trackErrors=function(e){return t.LIB_INSTANCE?t.LIB_INSTANCE.trackErrors(e):w},t.trackPageview=function(e,n,o){t.LIB_INSTANCE&&t.LIB_INSTANCE.submitPageView({pg:e},Boolean(o),{})},t.trackViews=function(e){return new Promise((function(n){t.LIB_INSTANCE?"undefined"==typeof document||"complete"===document.readyState?n(t.LIB_INSTANCE.trackPageViews(e)):window.addEventListener("load",(function(){n(t.LIB_INSTANCE.trackPageViews(e))})):n(w)}))}}));
//# sourceMappingURL=swetrix.js.map
